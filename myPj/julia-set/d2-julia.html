<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Julia-set Inverse Mapping</title>
  <meta name="google-site-verification" content="google1dd9a6e9f696a4f9" />

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />

  <!-- Bootstrap Icons -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
  />

  <!-- 自作の CSS -->
  <link rel="stylesheet" href="css/d2-style.css" />
</head>
<body class="bg-dark text-light">

  <!-- ─── ① ナビバー（外部ファイル読み込み） ─── -->
  <div id="navbar-placeholder"></div>
    
  <!-- ────────────── メインコンテナ ────────────── -->
  <div class="container-fluid px-3 py-4">
    <div class="row justify-content-center">
      <!-- この col-* を flexbox の縦並びかつ中央寄せに変更 -->
      <div class="col-lg-8 col-md-10 col-12 mb-4 d-flex flex-column align-items-center">

        <!-- Canvas を包むコンテナ -->
        <div id="canvas-container" class="w-100 position-relative border rounded overflow-hidden mb-2">
          <img
            id="bg-image"
            src="img/onmyo.png"
            alt="陰陽マーク"
            class="position-absolute top-50 start-50 translate-middle opacity-10"
            style="width: 40%;"
          />
          <canvas
            id="inverse-canvas"
            class="w-100"
            style="aspect-ratio: 4/3; background: transparent;"
            width="800"
            height="600"
          ></canvas>
        </div>

        <!-- 計算式表示 -->
        <div
          id="formula"
          class="mt-3 p-3 rounded text-center bg-transparent text-light"
          style="white-space: pre-wrap; width: 100%;"
        >
          ここに計算式・処理内容が表示されます。
        </div>

      </div>
    </div>
  </div>
  <!-- /.container-fluid -->

  <!-- ────────────── 設定フォーム用 Offcanvas ────────────── -->
  <div
    class="offcanvas offcanvas-start bg-dark text-light"
    tabindex="-1"
    id="offcanvasConfig"
    aria-labelledby="offcanvasConfigLabel"
  >
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title" id="offcanvasConfigLabel">設定</h5>
      <button
        type="button"
        class="btn-close btn-close-white"
        data-bs-dismiss="offcanvas"
        aria-label="閉じる"
      ></button>
    </div>
    <div class="offcanvas-body">
      <!-- 設定フォーム -->
      <div id="config">
        <div class="mb-3">
          <label for="cRe" class="form-label">c の実部 (cRe)</label>
          <input
            type="number"
            id="cRe"
            class="form-control form-control-lg"
            step="0.001"
            placeholder="例: -0.4"
            data-default-value="-0.4"
          >
          <div class="form-text text-light">
            ジュリア集合を決める複素定数 c の実部です。<br>
            推奨：−1.5〜1.5
          </div>
        </div>

        <div class="mb-3">
          <label for="cIm" class="form-label">c の虚部 (cIm)</label>
          <input
            type="number"
            id="cIm"
            class="form-control form-control-lg"
            step="0.001"
            placeholder="例: 0.6"
            data-default-value="0.6"
          >
          <div class="form-text text-light">
            ジュリア集合を決める複素定数 c の虚部です。推奨：0.0〜1.0
          </div>
        </div>

        <div class="mb-3">
          <label for="samples" class="form-label">samples (サンプリング数)</label>
          <input
            type="number"
            id="samples"
            class="form-control form-control-lg"
            step="1"
            placeholder="例: 45"
            data-default-value="45"
          >
          <div class="form-text text-light">
            最初の円を描画する点の数。45〜360 程度が目安。
          </div>
        </div>

        <div class="mb-3">
          <label for="maxIter" class="form-label">maxIter (世代数)</label>
          <input
            type="number"
            id="maxIter"
            class="form-control form-control-lg"
            step="1"
            placeholder="例: 12"
            data-default-value="12"
          >
          <div class="form-text text-light">
            逆写像を繰り返す回数。10〜20 程度が目安。
          </div>
        </div>

        <div class="mb-3">
          <label for="pauseMs" class="form-label">pauseMs (一時停止時間)</label>
          <input
            type="number"
            id="pauseMs"
            class="form-control form-control-lg"
            step="100"
            placeholder="例: 500"
            data-default-value="500"
          >
          <div class="form-text text-light">
            各ステップの停止時間 (ms)。500〜3000ms 程度がおすすめ。
          </div>
        </div>
      </div>
      <!-- 設定フォームここまで -->
    </div>
  </div>

  <!-- ────────────── 更新履歴用 Offcanvas ────────────── -->
  <div
    class="offcanvas offcanvas-end bg-dark text-light"
    tabindex="-1"
    id="offcanvasHistory"
    aria-labelledby="offcanvasHistoryLabel"
  >
    <div class="offcanvas-header border-bottom border-secondary">
      <h5 class="offcanvas-title" id="offcanvasHistoryLabel">更新履歴</h5>
      <button
        type="button"
        class="btn-close btn-close-white"
        data-bs-dismiss="offcanvas"
        aria-label="閉じる"
      ></button>
    </div>
    <div class="offcanvas-body">
      <ul class="list-unstyled small" style="line-height: 1.6;">
        <li class="mb-3">
          <time datetime="2025-06-01" class="fw-bold">2025-06-01</time><br>
          — 逆写像アニメーションの極座標補間を追加、ステップごとのカラー表示を改善<br>
          — 背景画像とキャンバスの重ね合わせ機能を実装
        </li>
        <li class="mb-3">
          <time datetime="2025-05-31" class="fw-bold">2025-05-31</time><br>
          — 初期バージョン公開（単位円→逆写像アニメーション）
        </li>
        <!-- 必要に応じてさらに追加できます -->
      </ul>
    </div>
  </div>

  <!-- ────────────── ページ下部：関連リンク ────────────── -->
  <footer class="text-center text-light mt-4">
    <div class="container">
      <p>
        関連 ▶▶
        <a
          href="https://uminomae.github.io/pjdhiro/20250531julia/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-info"
        >
          陰陽なJulia集合を逆にたどる
        </a>
      </p>
    </div>
  </footer>


<!-- ─── ナビバー読み込み＆d2-main.js 読み込み用スクリプト ─── -->
<script>
  async function includeHTML(selector, url) {
    const container = document.querySelector(selector);
    if (!container) {
      console.warn(`includeHTML: "${selector}" が見つかりません`);
      return;
    }
    try {
      console.log(`★ includeHTML: "${url}" を fetch 開始`);
      const resp = await fetch(url);
      if (!resp.ok) {
        throw new Error(`${url} の読み込みに失敗しました: ${resp.status}`);
      }
      const html = await resp.text();
      console.log(`★ includeHTML: "${url}" の取得成功 (${html.length} bytes)`);
      container.innerHTML = html;
      console.log(`★ includeHTML: "${selector}" に HTML を挿入完了`);
    } catch (err) {
      console.error(`★ includeHTML Error (${url}):`, err);
      container.innerHTML = `<!-- ${url} の読み込みエラー -->`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOMContentLoaded 発火 → navbar 読み込み開始');
    includeHTML('#navbar-placeholder', '2d-partials/navbar.html')
      .then(() => {
        console.log('→ navbar の読み込みが完了しました。ここで d2-main.js を追加します');
        const script = document.createElement('script');
        script.type = 'module';
        script.src = 'js/2d/d2-main.js';
        script.onload = () => console.log('★★ d2-main.js 読み込み完了');
        script.onerror = () => console.error('★★ d2-main.js の読み込みに失敗しました');
        document.body.appendChild(script);
      })
      .catch(err => {
        console.error('navbar の読み込みに失敗しました:', err);
        // 必要ならここで main.js を読み込むコードを呼び出す
      });
  });
</script>


  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"
  ></script>

  <!-- スクリプト本体 -->
  <!-- <script type="module" src="js/2d/d2-main.js"></script> -->
</body>
</html>
