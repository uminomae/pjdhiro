//@version=6
// myPj/tradingview/pine/libs/pjdhiro_ma_v6.pine
library("pjdhiro_ma_v6")

// =====================
// 移動平均（SMA）
// =====================

// Pineの引数 float は「series<float> も受けられる」ので OK。
// length は 1 未満だとエラーの元。常に 1 以上に正規化してから使う。
export sma(float src, int length) =>
    int ln = math.max(length, 1)
    ta.sma(src, ln)    // ta.* は TradingView 組み込みのテクニカル群


// length==0 を「未設定」として扱い、na を返す安全版。
// 内部では ln=1 で毎バー計算し、出力だけ値でマスク。
export safe_sma(float src, int length) =>
    bool on = length > 0
    int  ln = on ? length : 1
    float v = ta.sma(src, ln)
    on ? v : na